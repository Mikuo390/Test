<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>自訂紙張大小打印示例</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/print-js/1.6.0/print.min.js"></script>
    <style>
      /* 自訂打印樣式 */
      .print-container {
        text-align: center; /* 置中對齊 */
        margin: 20px; /* 外邊距 */
        font-size: 16px; /* 字體大小 */
      }
      .print-container img {
        max-width: 100%; /* 圖片最大寬度 */
        height: auto; /* 自適應高度 */
      }
      #previewArea {
        border: 1px solid #ccc; /* 預覽區域邊框 */
        padding: 10px; /* 內邊距 */
        margin-top: 20px; /* 上邊距 */
      }
      #entryList img {
        max-width: 200px; /* 限制圖片的最大寬度 */
        max-height: 200px; /* 限制圖片的最大高度 */
      }
      @page {
        margin: 35px;
      }
    </style>
  </head>
  <body>
    <h2>自訂紙張大小打印示例</h2>

    <form id="jsonInputForm">
      <label for="imageUpload">上傳圖片:</label>
      <input type="file" id="imageUpload" accept="image/*" /><br /><br />

      <label for="imageUrl">或輸入圖片 URL:</label>
      <input
        type="text"
        id="imageUrl"
        placeholder="請輸入圖片 URL"
      /><br /><br />

      <label for="description">描述:</label>
      <input
        type="text"
        id="description"
        placeholder="請輸入描述"
      /><br /><br />

      <button type="button" onclick="addEntry()">添加條目</button>
    </form>

    <h3>已添加的條目:</h3>
    <ul id="entryList"></ul>

    <h3>預覽區域:</h3>
    <div id="previewArea"></div>

    <h3>選擇紙張大小:</h3>
    <select id="paperSizeSelect" onchange="updatePaperSize()">
      <option value="custom">自訂</option>
      <option value="A4">A4 (8.27 × 11.69 英吋)</option>
      <option value="Letter">Letter (8.5 × 11 英吋)</option></select
    ><br /><br />

    <div id="customPaperSize">
      <label for="paperWidth">寬度 (單位: 英吋):</label>
      <input type="number" id="paperWidth" value="8.5" step="0.1" /><br /><br />

      <label for="paperHeight">高度 (單位: 英吋):</label>
      <input type="number" id="paperHeight" value="11" step="0.1" /><br /><br />
    </div>

    <button onclick="printPreview()">打印預覽</button>

    <script>
      // 儲存使用者輸入的條目
      const jsonData = [];

      // 紙張尺寸預定義
      const paperSizes = {
        A4: { width: 8.27, height: 11.69 },
        Letter: { width: 8.5, height: 11 },
      };

      function addEntry() {
        const imageUpload = document.getElementById("imageUpload");
        const imageUrl = document.getElementById("imageUrl").value;
        const description = document.getElementById("description").value;
        let imageSrc = "";

        if (imageUpload.files.length > 0) {
          const file = imageUpload.files[0];
          const reader = new FileReader();

          reader.onload = function (event) {
            imageSrc = event.target.result; // 獲取上傳的圖片的URL
            addToJson(imageSrc, description);
          };

          reader.readAsDataURL(file); // 讀取檔案為Data URL
        } else if (imageUrl) {
          imageSrc = imageUrl; // 使用輸入的URL
          addToJson(imageSrc, description);
        } else {
          alert("請上傳圖片或輸入圖片 URL，並填寫描述");
        }
      }

      function addToJson(imageSrc, description) {
        // 添加條目到 jsonData
        jsonData.push({
          data: `<div class="print-container"><img src='${imageSrc}' alt='示例圖片' style='max-width:200px; max-height:200px;'><br>${description}</div>`,
        });

        // 更新條目列表
        const entryList = document.getElementById("entryList");
        const listItem = document.createElement("li");
        listItem.innerHTML = `${description} (<img src='${imageSrc}' alt='示例圖片' style='width:50px; height:auto;'>)`;
        entryList.appendChild(listItem);

        // 更新預覽區域
        updatePreview();

        // 清空輸入框
        document.getElementById("imageUpload").value = "";
        document.getElementById("imageUrl").value = "";
        document.getElementById("description").value = "";
      }

      function updatePreview() {
        const previewArea = document.getElementById("previewArea");
        previewArea.innerHTML = ""; // 清空預覽區域

        jsonData.forEach((item) => {
          previewArea.innerHTML += item.data; // 添加內容到預覽區域
        });
      }

      function updatePaperSize() {
        const selectedSize = document.getElementById("paperSizeSelect").value;
        const customPaperSize = document.getElementById("customPaperSize");

        if (selectedSize === "custom") {
          customPaperSize.style.display = "block"; // 顯示自訂紙張大小輸入框
        } else {
          customPaperSize.style.display = "none"; // 隱藏自訂紙張大小輸入框
        }
      }

      function printPreview() {
        if (jsonData.length === 0) {
          alert("請添加至少一個條目");
          return;
        }

        const selectedSize = document.getElementById("paperSizeSelect").value;
        let paperWidth, paperHeight;

        if (selectedSize === "custom") {
          paperWidth = parseFloat(document.getElementById("paperWidth").value);
          paperHeight = parseFloat(
            document.getElementById("paperHeight").value
          );
        } else {
          paperWidth = paperSizes[selectedSize].width;
          paperHeight = paperSizes[selectedSize].height;
        }

        // 調用 printJS 進行打印
        printJS({
          printable: jsonData,
          type: "json",
          properties: ["data"], // 仅打印 data 属性
          style:
            ".print-container { text-align: center; margin: 20px; font-size: 16px; } " +
            ".print-container img { max-width: 100%; height: auto; }",
          paperSize: {
            width: paperWidth,
            height: paperHeight,
            unit: "in",
          },
        });
      }

      // 初始化時隱藏自訂紙張大小輸入框
      updatePaperSize();
    </script>
  </body>
</html>
