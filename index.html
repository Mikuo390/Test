<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZXing 條碼掃描</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
        }
        video {
            border: 1px solid #ccc;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>ZXing 條碼掃描</h1>

    <!-- 顯示攝像頭的區域 -->
    <video id="video" width="300" height="200" autoplay></video>

    
    <!-- 顯示掃描結果的區域 -->
    <div id="result" style="margin-top: 20px;">
        條碼結果：<span id="barcode-result"></span>
    </div>

    <!-- 正確引入 @zxing/library 的 UMD 版本 -->
    <script src="https://cdn.jsdelivr.net/npm/@zxing/library@latest/umd/index.min.js"></script>

    <script>
        // 初始化 ZXing 條碼讀取器
        const codeReader = new ZXing.BrowserMultiFormatReader();

        // 檢查攝像頭權限並開始掃描
        async function startScanning() {
            try {
                // 獲取可用的攝像頭設備
                const videoInputDevices = await codeReader.getVideoInputDevices();
                if (videoInputDevices.length > 0) {
                    console.log(videoInputDevices)
                    const firstDeviceId = videoInputDevices[1].deviceId;

                    // 開始從攝像頭捕獲視頻
                    codeReader.decodeFromVideoDevice(firstDeviceId, 'video', (result, err) => {
                        if (result) {
                            // 顯示解碼後的結果
                            document.getElementById('barcode-result').textContent = result.text;
                        }
                        if (err && !(err instanceof ZXing.NotFoundException)) {
                            console.error(err);
                        }
                    });
                } else {
                    console.error('沒有找到攝像頭設備');
                }
            } catch (err) {
                console.error('無法獲取攝像頭設備:', err);
            }
        }

        // 啟動掃描
        startScanning();
    </script>
</body>
</html>
